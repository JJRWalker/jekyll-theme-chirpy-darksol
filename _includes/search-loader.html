<!--
  Jekyll Simple Search loader
  See: <https://github.com/christian-fei/Simple-Jekyll-Search>
-->

{% capture result_elem %}
  <article class="card-wrapper card">
    <a href="{url}" class="post-preview row g-0 flex-md-row-reverse">
      {% assign card_body_col = '12' %}
      <div class="col-md-{{ card_body_col }}">
        <div class="card-body d-flex flex-column">
          <h1 class="card-title my-2 mt-md-0">{title}</h1>

          <div class="card-text content mt-0 mb-3">
            <p>{content}</p>
          </div>
          <div class="post-meta flex-grow-1 d-flex align-items-end">
            <div class="me-auto">
              <!-- posted date -->
              <i class="far fa-calendar fa-fw me-1"></i>
              {% if date != "null" %}
                {% include datetime.html date="{date}" lang=lang json=false %}
              {% endif %}
              <!-- categories -->
              {% assign post_categories = "{categories}" | split: ", " %}
              {% if post_categories.size > 0 %}
                <i class="far fa-folder-open fa-fw me-1"></i>
                <span class="categories">
                  {% for category in post_categories %}
                    {{ category }}
                    {%- unless forloop.last -%},{%- endunless -%}
                  {% endfor %}
                </span>
              {% endif %}
              <span class="categories">
              {tags}
              </span>
            </div>
          </div>
          <!-- .post-meta -->
        </div>
        <!-- .card-body -->
      </div>
    </a>
  </article>
{% comment %}
  <article class="px-1 px-sm-2 px-lg-4 px-xl-0">
    <header>
      <h2><a href="{url}">{title}</a></h2>
      <div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1">
        {categories}
        {tags}
      </div>
    </header>
    <p>{content}</p>
  </article>
  {% endcomment %}
{% endcapture %}

{% capture not_found %}<p class="mt-5">{{ site.data.locales[include.lang].search.no_results }}</p>{% endcapture %}

<script>
  {% comment %} Note: dependent library will be loaded in `js-selector.html` {% endcomment %}
  document.addEventListener('DOMContentLoaded', () => {
    SimpleJekyllSearch({
      searchInput: document.getElementById('search-input'),
      resultsContainer: document.getElementById('search-results'),
      json: '{{ '/assets/js/data/search.json' | relative_url }}',
      searchResultTemplate: '{{ result_elem | strip_newlines }}',
      noResultsText: '{{ not_found }}',
      templateMiddleware: function(prop, value, template) {
        if (prop === 'categories') {
          if (value === '') {
            return ``;
          } else {
            return `${value}`;
          }
        }

        if (prop === 'tags') {
          if (value === '') {
            return `${value}`;
          } else {
            return `<i class="fa fa-tag fa-fw"></i>${value}`;
          }
        }

        if (prop === 'date')
        {
          if (value === ''){
            return ``;
          }
          else {
            return `${value}`;
          }
        }

        if (prop === 'content'){
          if (value === ''){
            return ``;
          }
          else{
            return `${value}`;
          }
        }
      }
    });
  });
</script>
